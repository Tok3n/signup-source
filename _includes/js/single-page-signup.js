// Generated by CoffeeScript 1.7.1
(function() {
  $(function() {
    var appInitialView, initialViewName, switcher, timer, tockFormat, tockOptions, viewSwitcheroptions;
    $.ajax({
      url: "json/country-phone-data.json",
      cache: false
    }).done(function(data) {
      return App.countryData = data;
    });
    appInitialView = "#signupHome";
    if (location.hash === "" || location.hash === "#") {
      initialViewName = appInitialView;
    } else {
      initialViewName = location.hash;
    }
    viewSwitcheroptions = {};
    viewSwitcheroptions.views = ".view-wrapper";
    viewSwitcheroptions.container = ".view-wrapper-inner";
    viewSwitcheroptions.initialView = initialViewName;
    App.switcher = switcher = ViewSwitcher(viewSwitcheroptions);
    $(window).on("hashchange", function(event) {
      var name, view;
      if (location.hash === "" || location.hash === "#") {
        name = appInitialView.substring(1);
      } else {
        name = location.hash.substring(1);
      }
      view = switcher.selectView(name);
      if (view) {
        switcher(name);
      }
      if (name === "confirmCode") {
        return $(".tel-num").html(App.phoneData.componentById("phoneNumberInput").value());
      }
    });
    tockOptions = {
      countdown: true,
      interval: 500,
      callback: function() {
        return $(".code-countdown").html(tockFormat(timer.msToTime(timer.lap())));
      },
      complete: function() {
        return console.log("Tock complete");
      }
    };
    tockFormat = function(rawTime) {
      return rawTime.split(".")[0].substring(1);
    };
    App.timer = timer = new Tock(tockOptions);
    $(window).on("hashchange", function() {
      return timer.stop();
    });
    return switcher.on("renderComplete", function(event, name, view) {
      if (name === "confirmCode") {
        return timer.start(120500);
      }
    });
  });

  (function() {
    var InputCollection, InputFactory, accountData, buttons, confirmCode, countrySelect, firstPage, phoneData, phoneNumberInput, sendCodeButton, sendTextButton, signupRadio;
    InputCollection = InputJS.InputCollection;
    InputFactory = InputJS.InputFactory;
    accountData = [];
    accountData.push(document.querySelector("#firstNameInput"));
    accountData.push(document.querySelector("#lastNameInput"));
    accountData.push(document.querySelector("#emailInput"));
    App.accountData = accountData = new InputCollection(accountData);
    App.signupRadio = signupRadio = new InputCollection(document.querySelectorAll("[name='signupOptions']"));
    signupRadio.isValid = function() {
      return this.values().length > 0;
    };
    sendCodeButton = new InputJS.ButtonComponent(document.querySelector("#sendCodeButton"));
    sendCodeButton.disable();
    App.firstPage = firstPage = new InputCollection([accountData, signupRadio]);
    firstPage.addEventListener("keyup", function(event) {
      if (this.isValid()) {
        return sendCodeButton.enable();
      }
    });
    sendCodeButton.addEventListener("click", function(event) {
      event.preventDefault();
      return location.hash = "#" + signupRadio.value()[0];
    });
    buttons = document.querySelectorAll("button[data-hash]");
    Array.prototype.forEach.call(buttons, function(button) {
      if (button === sendCodeButton.el) {
        return;
      }
      return button.addEventListener("click", function(event) {
        event.preventDefault();
        return location.hash = this.attributes["data-hash"].value;
      });
    });
    sendTextButton = new InputJS.ButtonComponent(document.querySelector("#confirmCodeButton"));
    sendTextButton.disable();
    phoneData = [];
    countrySelect = InputFactory("#countrySelect");
    phoneNumberInput = InputFactory("#phoneNumberInput");
    App.phoneData = phoneData = new InputCollection([countrySelect, phoneNumberInput]);
    countrySelect.addEventListener("change", function(event) {
      var match, value;
      console.log((value = this.value()));
      match = App.countryData.filter(function(country) {
        return country.englishName === value;
      });
      if (match.length) {
        phoneNumberInput.placeholder(match[0].example);
        return document.querySelector("#phoneNumberCountryCode").innerHTML = "+" + match[0].phoneCode;
      }
    });
    phoneNumberInput.addEventListener("keyup", function(event) {
      if (phoneData.isValid()) {
        return sendTextButton.enable();
      }
    });
    return confirmCode = InputFactory("#confirmCodeInput");
  })();

}).call(this);
